<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script2WAVE - 대화록 음성 변환</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/static/css/style.css?v=6">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- 헤더 -->
        <header class="app-header">
            <div class="header-left">
                <h1 class="app-title">Script2WAVE</h1>
            </div>
            <div class="header-center">
                <div class="stats-inline">
                    <span class="stat-item">전체 <strong id="statTotal">0</strong></span>
                    <span class="stat-item">처리중 <strong id="statProcessing">0</strong></span>
                    <span class="stat-item">완료 <strong id="statCompleted">0</strong></span>
                    <span class="stat-item">실패 <strong id="statFailed">0</strong></span>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-secondary" id="settingsBtn">설정</button>
                <button class="btn btn-secondary" id="refreshBtn">새로고침</button>
            </div>
        </header>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">
            <!-- 업로드 섹션 -->
            <section class="upload-section">
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-text">
                        <span class="upload-main">대화록 파일을 드래그하거나 클릭하여 업로드</span>
                        <span class="upload-hint">txt 파일 (다중 선택 가능)</span>
                    </div>
                    <input type="file" id="fileInput" multiple hidden>
                </div>
                <div class="upload-queue" id="uploadQueue" style="display: none;">
                    <div class="queue-header">
                        <span id="queueCount">0개 파일 대기</span>
                        <div class="queue-actions">
                            <button class="btn btn-small" id="clearQueueBtn">비우기</button>
                            <button class="btn btn-primary btn-small" id="startUploadBtn">변환 시작</button>
                        </div>
                    </div>
                    <div class="queue-list" id="queueList"></div>
                </div>
            </section>

            <!-- 툴바 -->
            <section class="toolbar-section">
                <div class="toolbar-left">
                    <input type="text" id="searchInput" placeholder="파일명 검색..." class="search-input" autocomplete="off">
                    <button class="btn btn-secondary" id="searchBtn">검색</button>
                </div>
                <div class="toolbar-right">
                    <select id="statusFilter" class="select-input">
                        <option value="">전체</option>
                        <option value="pending">대기중</option>
                        <option value="completed">완료</option>
                        <option value="failed">실패</option>
                    </select>
                    <select id="pageSizeSelect" class="select-input">
                        <option value="10">10개</option>
                        <option value="20" selected>20개</option>
                        <option value="50">50개</option>
                        <option value="100">100개</option>
                    </select>
                </div>
            </section>

            <!-- 일괄 작업 바 -->
            <div class="batch-bar" id="batchBar" style="display: none;">
                <span class="batch-info"><span id="selectedCount">0</span>개 선택</span>
                <div class="batch-actions">
                    <button class="btn btn-small" id="batchDownloadBtn">다운로드</button>
                    <button class="btn btn-small" id="batchRetryBtn">재시도</button>
                    <button class="btn btn-small delete" id="batchDeleteBtn">삭제</button>
                </div>
            </div>

            <!-- 작업 테이블 -->
            <section class="table-section">
                <table class="data-table" id="jobsTable">
                    <thead>
                        <tr>
                            <th class="th-checkbox"><input type="checkbox" id="selectAllJobs"></th>
                            <th class="sortable" data-sort="original_filename">파일명</th>
                            <th>상태</th>
                            <th>진행률</th>
                            <th class="sortable" data-sort="duration_seconds">길이</th>
                            <th class="sortable active" data-sort="created_at">생성일</th>
                            <th>작업</th>
                        </tr>
                    </thead>
                    <tbody id="jobsTableBody"></tbody>
                </table>
            </section>

            <!-- 페이지네이션 -->
            <section class="pagination-section">
                <div class="pagination-info" id="paginationInfo">0개</div>
                <div class="pagination" id="pagination"></div>
            </section>
        </main>
    </div>

    <!-- 통합 미리보기 모달 (오디오 + JSON) -->
    <div class="modal" id="previewModal">
        <div class="modal-content modal-preview">
            <div class="modal-header">
                <h3 id="previewTitle">미리보기</h3>
                <button class="modal-close" id="closePreviewModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 오디오 플레이어 -->
                <div class="player-section">
                    <audio id="audioPlayer" controls></audio>
                    <div class="player-info">
                        <span id="currentTime">0:00</span> / <span id="totalTime">0:00</span>
                    </div>
                </div>
                
                <!-- 다운로드 버튼 -->
                <div class="download-section">
                    <button class="btn btn-small" id="downloadWavBtn">WAV 다운로드</button>
                    <button class="btn btn-small" id="downloadJsonBtn">JSON 다운로드</button>
                    <button class="btn btn-primary btn-small" id="downloadAllBtn">전체 다운로드</button>
                </div>
                
                <!-- 발화 목록 -->
                <div class="utterances-section">
                    <div class="utterances-header">
                        <span>발화 목록</span>
                        <span id="utteranceCount">0개</span>
                    </div>
                    <div class="utterances-list" id="utterancesList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 설정 모달 -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>설정</h3>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <label class="settings-label">ElevenLabs API 키</label>
                    <div class="settings-row">
                        <input type="text" id="apiKeyInput" placeholder="sk_..." class="settings-input" autocomplete="off">
                        <button class="btn btn-primary btn-small" id="saveApiKeyBtn">저장</button>
                    </div>
                    <div class="settings-status" id="apiKeyStatus">
                        API 키 상태: 확인 중...
                    </div>
                    <div class="settings-hint">
                        * 세션 기반: 브라우저를 닫거나 서버 재시작 시 삭제됩니다.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 토스트 -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- 로딩 -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">처리 중...</div>
    </div>

    <script src="/static/js/app.js?v=6"></script>
</body>
</html>
